<?php
App::uses('UploaderAppController', 'Uploader.Controller');
/**
 * Adds Controller
 *
 */
class AddsController extends UploaderAppController {

/**
 * Scaffold
 *
 * @var mixed
 */
	public $scaffold;
	public $components = array('Session','Paginator');

	var $modelname = 'Testfile';

	public function import ($id = null){
		$mname = $this->modelname;
		$this->loadModel($mname);

		if ($this->request->is('post')) {
			for ($i = 0; $i <= count($this->request->data['Add'])-1; $i++){
			move_uploaded_file($this->request->data['Add']['submittedfile'.$i]['tmp_name'], WWW_ROOT . 'files' . DS . $this->request->data['Add']['submittedfile'.$i]['name']);
			//move_uploaded_file($this->request->data['Add']['submittedfile1']['tmp_name'],WWW_ROOT . 'files' . DS . $this->request->data['Add']['submittedfile1']['name']);
			}
			die;
			
				//Creates a temp copy to be moved
			$filename = explode('.', $this->request->data['Add']['submittedfile']['name']);
				//Sets file name based on the original file name and extension
			$filename = $filename[0]. '.' . $filename[count($filename)-1];
				//Moves uploaded file to webroot/fils
			move_uploaded_file($this->request->data['Add']['submittedfile']['tmp_name'],WWW_ROOT . DS . 'files' . DS . $filename);
				//Creates new file object
			$file = new File(WWW_ROOT . 'files' . DS . $filename);
				//Creates file 
			$filedata = array($filename,$file->path);
			
			$databasematch = array_keys($this->$mname->getColumnTypes($mname));
			array_shift($databasematch);

				//Model Name for Cake Array Syntax			
			$arr = array($mname);
			$filearr = array_fill_keys($databasematch, '');
			$filearr = array_combine($databasematch, $filedata);
			$filearr = array_fill_keys($arr, $filearr);
			
			$this->$mname->save($filearr);
			if ($this->$mname->save($filearr)) {
				$this->Session->setFlash(__('The file has been uploaded.'));
				return $this->redirect(array('action' => '../../'));
			} else {
				$this->Session->setFlash(__('The file could not be uploaded. Please, try again.'));
				return $this->redirect(array('action' => '../../')); //controller =>
			}


			
			
		}


	}

}
